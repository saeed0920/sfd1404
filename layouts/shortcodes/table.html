{{ $donations := append site.Data.donations site.Data.donations_static }}
{{ $donations := sort $donations "amount" "desc" }}

{{ $donationsTotalInTomans := 0.0 }}
{{ range $donations }}
  {{ $donationsTotalInTomans = add $donationsTotalInTomans (div (float .amount) 10) }}
{{ end }}

{{ $expenses := sort site.Data.expenses "amount" "desc" }}

{{ $expensesTotalInTomans := 0.0 }}
{{ range site.Data.expenses }}
  {{ $expensesTotalInTomans = add $expensesTotalInTomans (div (float .amount) 10) }}
{{ end }}

{{ $percent := 0.0 }}
{{ if gt $expensesTotalInTomans 0 }}
  {{ $percent = math.Min 100 (mul (div $donationsTotalInTomans $expensesTotalInTomans) 100) }}
{{ end }}

<div style="text-align: center; margin-bottom: 2rem; margin-top : 4rem;">
  <h1 style="font-size: 1.8rem; font-weight: 700; color: #1e293b;">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ</h1>
  <p style="font-size: 1rem; color: #4b5563; max-width: 600px; margin: 0.5rem auto;">
    Ø®ÛŒÙ„ÛŒ Ø¨Ø§Ø¹Ø« Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ Ùˆ Ø§ÙØªØ®Ø§Ø±Ù‡ Ú©Ù‡ Ø¬Ø´Ù† Ø¢Ø²Ø§Ø¯ÛŒ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±Ù…ÙˆÙ† ØªÙ‚Ø±ÛŒØ¨Ø§ Ø¨Ø§ Ø¯ÙˆÙ†ÛŒØ´Ù†â€ŒÙ‡Ø§ Ø¯Ø§Ø±Ù‡ Ø¨Ø±Ú¯Ø²Ø§Ø± Ù…ÛŒâ€ŒØ´Ù‡. Ø¨Ø±Ø§ÛŒ Ø´ÙØ§ÙÛŒØª Ø¨ÛŒØ´ØªØ±ØŒ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ Ø±ÛŒØ² Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¯ÙˆÙ†ÛŒØ´Ù†â€ŒÙ‡Ø§ Ø±Ùˆ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ø¯Ø± Ø§Ø¯Ø§Ù…Ù‡ ØµÙØ­Ù‡ Ø¨Ø¨ÛŒÙ†ÛŒØ¯!
  </p>
</div>

<div class="financial-card">
  <h2>  ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ÛŒ ğŸ’°</h2>

  <div class="financial-bar ">
    <div class="donations-bar" style="position: absolute; left:0; top:0; height:100%; width: {{ printf "%.0f" $percent }}%; border-radius: 8px 0 0 8px; transition: width 0.5s ease;"></div>
  </div>

  <div class="summary">
    <p>Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„: 
      <!-- <script>document.write(Number({{ printf "%.0f" $donationsTotalInTomans }}).toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†');</script> -->
      <span class="count gold-text" data-value="{{ printf "%.0f" $donationsTotalInTomans }}"></span> ØªÙˆÙ…Ø§Ù†
    </p>
   
    <p>Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù„: <script>document.write(Number({{ printf "%.0f" $expensesTotalInTomans }}).toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†');</script></p>
  </div>
</div>

<div class="cards-container">
  {{/* donations */}}
  <div class="cards-container_card">
    <h3>Ø­Ù…Ø§ÛŒØª Ù‡Ø§ ğŸ“¥ </h3>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>
            <th>ØªØ§Ø±ÛŒØ® Ù¾Ø±Ø¯Ø§Ø®Øª</th>
            <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
            <th>Ù…Ø¨Ù„Øº</th>
          </tr>
        </thead>
        <tbody>
          {{ if $donations }}
            {{ range $i, $d := $donations }}
              <tr>
                <td data-label="#"> {{ add $i 1 }}</td>
                <td data-label="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">{{ $d.donator_name }}</td>
                <td data-label="ØªØ§Ø±ÛŒØ® Ù¾Ø±Ø¯Ø§Ø®Øª">{{ $d.date }}</td>
                <td data-label="ØªÙˆØ¶ÛŒØ­Ø§Øª">{{ $d.message }}</td>
                <td data-label="Ù…Ø¨Ù„Øº">
                  <script>
                    document.write(Number({{ div (float $d.amount) 10 }}).toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†');
                  </script>
                </td>
              </tr>
            {{ end }}
          {{ else }}
            <tr class="empty-row">
              <td colspan="5">Ø®Ø§Ù„ÛŒ</td>
            </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
  </div>

  {{/* expenses */}}
  <div class="cards-container_card">
    <h3> Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ ğŸ“¤</h3>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Ø¹Ù†ÙˆØ§Ù†</th>
            <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
            <th>Ù…Ø¨Ù„Øº</th>
          </tr>
        </thead>
        <tbody>
          {{ if $expenses }}
            {{ range $i, $e := $expenses }}
              <tr>
                <td data-label="#"> {{ add $i 1 }}</td>
                <td data-label="Ø¹Ù†ÙˆØ§Ù†">{{ $e.title }}</td>
                <td data-label="ØªÙˆØ¶ÛŒØ­Ø§Øª">{{ $e.description }}</td>
                <td data-label="Ù…Ø¨Ù„Øº">
                  <script>
                    document.write(Number({{ div (float $e.amount) 10 }}).toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†');
                  </script>
                </td>
              </tr>
            {{ end }}
          {{ else }}
            <tr class="empty-row">
              <td colspan="4">Ø®Ø§Ù„ÛŒ</td>
            </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
  function animateCount(el, duration = 4000) {
    const target = parseInt(el.getAttribute("data-value"), 10);
    const start = 0;
    const startTime = performance.now();

    function update(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const value = Math.floor(progress * (target - start) + start);
      el.textContent = value.toLocaleString("fa-IR");
      if (progress < 1) {
        requestAnimationFrame(update);
      }
    }

    requestAnimationFrame(update);
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".count").forEach(el => animateCount(el));
  });
</script>
